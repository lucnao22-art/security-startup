{% extends "base.html" %}
{% load django_bootstrap5 %}

{% block title %}Chi tiết Mục tiêu: {{ muc_tieu.ten_muc_tieu }}{% endblock %}

{% block content %}
<div class="container">
    <div class="card mb-4">
        <div class="card-header">
            <h3>{{ muc_tieu.ten_muc_tieu }}</h3>
        </div>
        <div class="card-body">
            <p><strong>Địa chỉ:</strong> {{ muc_tieu.dia_chi }}</p>
            <p><strong>Chỉ huy trưởng:</strong> {{ muc_tieu.chi_huy_truong.ho_ten|default:"Chưa gán" }}</p>
            <p><strong>Số vị trí chốt:</strong> {{ vi_tri_chot_list.count }}</p>
            <p><strong>Số nhân viên hiện tại:</strong> {{ nhan_vien_list.count }}</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header"><h5><i class="fas fa-id-card"></i> Danh sách Nhân viên</h5></div>
                <ul class="list-group list-group-flush">
                    {% for nv in nhan_vien_list %}
                        <li class="list-group-item">{{ nv.ho_ten }} ({{ nv.ma_nhan_vien }})</li>
                    {% empty %}
                        <li class="list-group-item text-muted">Chưa có nhân viên nào.</li>
                    {% endfor %}
                </ul>
            </div>

            <div class="card mb-4">
                <div class="card-header"><h5><i class="fas fa-tools"></i> Công cụ Hỗ trợ</h5></div>
                <ul class="list-group list-group-flush">
                    {% for ccdc in ccdc_list %}
                        <li class="list-group-item">{{ ccdc.vat_tu.ten_vat_tu }} - SL: {{ ccdc.so_luong }}</li>
                    {% empty %}
                        <li class="list-group-item text-muted">Chưa có CCDC nào được cấp phát.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header"><h5><i class="fas fa-exclamation-triangle"></i> Lịch sử Sự cố Gần đây</h5></div>
                <ul class="list-group list-group-flush">
                    {% for sc in su_co_list %}
                        <li class="list-group-item">
                            <strong>{{ sc.tieu_de }}</strong><br>
                            <small class="text-muted">{{ sc.thoi_gian_bao_cao|date:"H:i d/m/Y" }} - Báo cáo bởi: {{ sc.ca_truc.nhan_vien.ho_ten }}</small>
                        </li>
                    {% empty %}
                        <li class="list-group-item text-muted">Chưa có sự cố nào được ghi nhận.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}